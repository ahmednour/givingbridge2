# 📊 مخطط قاعدة البيانات - مرئي

---

## 🎯 المخطط الكامل

```
┌─────────────────────────────────────────────────────────────┐
│                         USERS                               │
│                      (المستخدمون)                           │
├─────────────────────────────────────────────────────────────┤
│ • id (PK)                                                   │
│ • name                                                      │
│ • email                                                     │
│ • password                                                  │
│ • role: donor | receiver | admin                           │
│ • phone                                                     │
│ • location                                                  │
└─────────────────────────────────────────────────────────────┘
         │                           │                    │
         │ (as donor)                │ (as receiver)      │ (as admin)
         │ 1:N                       │ 1:N                │ 1:N
         ↓                           ↓                    ↓
┌──────────────────────┐    ┌──────────────────┐    ┌─────────┐
│     DONATIONS        │    │    REQUESTS      │    │ approves│
│     (التبرعات)       │    │    (الطلبات)     │    │         │
├──────────────────────┤    ├──────────────────┤    └─────────┘
│ • id (PK)            │◄───┤ • donationId(FK) │
│ • title              │ 1:N│ • receiverId(FK) │
│ • description        │    │ • donorId (FK)   │
│ • category           │    │ • message        │
│ • condition          │    │ • status         │
│ • location           │    │   - pending      │
│ • donorId (FK)       │    │   - approved     │
│ • imageUrl           │    │   - declined     │
│ • status             │    │   - completed    │
│   - available        │    └──────────────────┘
│   - completed        │
│ • approvalStatus     │
│   - pending          │
│   - approved         │
│   - rejected         │
│ • approvedBy (FK)    │
└──────────────────────┘
```

---

## 🔄 دورة الحياة الكاملة

```
┌─────────────────────────────────────────────────────────────┐
│                    STEP 1: إنشاء التبرع                     │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────────────────────────┐
        │  Donor creates Donation              │
        │  approvalStatus = "pending"          │
        └──────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    STEP 2: موافقة المدير                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────────────────────────┐
        │  Admin reviews Donation              │
        │  approvalStatus = "approved"         │
        │  approvedBy = admin.id               │
        └──────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    STEP 3: عرض التبرعات                     │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────────────────────────┐
        │  Receiver sees approved Donations    │
        │  WHERE approvalStatus = "approved"   │
        └──────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    STEP 4: طلب التبرع                       │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────────────────────────┐
        │  Receiver creates Request            │
        │  donationId = donation.id            │
        │  status = "pending"                  │
        └──────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    STEP 5: موافقة المتبرع                   │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────────────────────────┐
        │  Donor reviews Request               │
        │  status = "approved"                 │
        └──────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    STEP 6: إتمام التسليم                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌──────────────────────────────────────┐
        │  Request.status = "completed"        │
        │  Donation.status = "completed"       │
        └──────────────────────────────────────┘
```

---

## 👥 الأدوار الثلاثة

```
┌─────────────────┐
│     DONOR       │
│   (المتبرع)     │
├─────────────────┤
│ يستطيع:         │
│ ✅ إنشاء تبرع   │
│ ✅ عرض طلباته   │
│ ✅ قبول/رفض طلب │
│ ✅ تعديل تبرعه  │
└─────────────────┘

┌─────────────────┐
│    RECEIVER     │
│   (المستقبل)    │
├─────────────────┤
│ يستطيع:         │
│ ✅ عرض التبرعات │
│ ✅ طلب تبرع     │
│ ✅ عرض طلباته   │
│ ✅ إلغاء طلب    │
└─────────────────┘

┌─────────────────┐
│     ADMIN       │
│    (المدير)     │
├─────────────────┤
│ يستطيع:         │
│ ✅ عرض كل شيء   │
│ ✅ موافقة تبرع  │
│ ✅ رفض تبرع     │
│ ✅ إدارة مستخدم │
└─────────────────┘
```

---

## 📊 مثال بالأرقام

```
┌──────────────────────────────────────────────────────────┐
│ User #1: محمد (Donor)                                    │
└──────────────────────────────────────────────────────────┘
                    │
                    │ creates
                    ↓
┌──────────────────────────────────────────────────────────┐
│ Donation #5: "ملابس شتوية"                              │
│ • donorId = 1                                            │
│ • approvalStatus = "pending"                             │
└──────────────────────────────────────────────────────────┘
                    │
                    │ reviewed by
                    ↓
┌──────────────────────────────────────────────────────────┐
│ User #3: أحمد (Admin)                                    │
│ • approves Donation #5                                   │
│ • approvedBy = 3                                         │
└──────────────────────────────────────────────────────────┘
                    │
                    │ seen by
                    ↓
┌──────────────────────────────────────────────────────────┐
│ User #2: فاطمة (Receiver)                                │
└──────────────────────────────────────────────────────────┘
                    │
                    │ creates
                    ↓
┌──────────────────────────────────────────────────────────┐
│ Request #10                                              │
│ • donationId = 5                                         │
│ • receiverId = 2                                         │
│ • donorId = 1                                            │
│ • status = "pending"                                     │
└──────────────────────────────────────────────────────────┘
                    │
                    │ reviewed by
                    ↓
┌──────────────────────────────────────────────────────────┐
│ User #1: محمد (Donor)                                    │
│ • approves Request #10                                   │
│ • status = "approved"                                    │
└──────────────────────────────────────────────────────────┘
```

---

## 🔍 الاستعلامات الشائعة

### 1. عرض التبرعات المتاحة (للمستقبل)

```sql
SELECT * FROM donations 
WHERE approvalStatus = 'approved' 
  AND status = 'available'
ORDER BY createdAt DESC
```

### 2. عرض طلبات المتبرع

```sql
SELECT r.*, d.title, u.name as receiverName
FROM requests r
JOIN donations d ON r.donationId = d.id
JOIN users u ON r.receiverId = u.id
WHERE r.donorId = 1
  AND r.status = 'pending'
```

### 3. عرض التبرعات المعلقة (للمدير)

```sql
SELECT d.*, u.name as donorName
FROM donations d
JOIN users u ON d.donorId = u.id
WHERE d.approvalStatus = 'pending'
ORDER BY d.createdAt ASC
```

---

## ⚠️ ملاحظات مهمة

### 1. لماذا donorId في Request؟

```
بدون donorId:
Request → Donation → User
(2 JOIN operations)

مع donorId:
Request → User
(1 JOIN operation)

النتيجة: أسرع بـ 50%
```

### 2. لماذا donorName في Donation؟

```
بدون donorName:
كل مرة نعرض تبرع نحتاج JOIN مع users

مع donorName:
نعرض الاسم مباشرة بدون JOIN

النتيجة: أسرع بكثير
```

### 3. لماذا لا يوجد amount؟

```
المنصة للتبرعات العينية:
✅ ملابس
✅ طعام
✅ كتب
✅ أجهزة

وليست للتبرعات المالية:
❌ مبالغ نقدية
```

---

## ✅ الخلاصة المرئية

```
┌─────────────────────────────────────────────────────────┐
│                   GivingBridge                          │
│              منصة التبرعات العينية                      │
└─────────────────────────────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ↓                ↓                ↓
   ┌────────┐      ┌────────┐      ┌────────┐
   │ Donor  │      │Receiver│      │ Admin  │
   │ متبرع  │      │مستقبل  │      │ مدير   │
   └────────┘      └────────┘      └────────┘
        │                │                │
        │ creates        │ requests       │ approves
        ↓                ↓                ↓
   ┌────────┐      ┌────────┐      ┌────────┐
   │Donation│◄─────│Request │      │Donation│
   │ تبرع   │ 1:N  │ طلب    │      │ موافقة │
   └────────┘      └────────┘      └────────┘
```

---

**التصميم واضح ومنطقي! ✅**
